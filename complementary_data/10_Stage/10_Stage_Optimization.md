### Этап 10

#####  Для одного из запросов, созданных в пункте 6, провести оптимизацию. В качестве отчета приложить планы выполнения запроса, ваш анализ и показать действия, которые улучшили эффективность запроса.

План запроса.

![image-20220926162219263](C:\Users\Папа\AppData\Roaming\Typora\typora-user-images\image-20220926162219263.png)



Основное время занимает сортировка. Не вижу тут возможностей оптимизации, кроме построения индексов. Кроме таблицы stars, везде используются поля первичного ключа. Соответственно надо построить три индекса на таблицу stars. Поле movie_id, по которому проходит объединение и отбор окон, поле user_id, по которому проходит объединение и поле rated_at, по которому проходит сортировка.

---

Создаем индексы. Результат не поменялся, и по прежнему используется Sec Scan.

![image-20220926170514538](C:\Users\Папа\AppData\Roaming\Typora\typora-user-images\image-20220926170514538.png)

---

Попробуем принудительно использовать индексы

![image-20220926170852214](C:\Users\Папа\AppData\Roaming\Typora\typora-user-images\image-20220926170852214.png)

Результат не поменялся. Делаем вывод, что на таком количестве тестовых данных (stars - 400, movies и users по 150) оптимизация не требуется.



